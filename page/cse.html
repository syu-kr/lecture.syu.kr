<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>SYU LECTURE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="https://syu.kr/favicon/favicon.ico" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8E24NNDK21"></script>
    <script>
      window.dataLayer = window.dataLayer || []
      function gtag() {
        dataLayer.push(arguments)
      }
      gtag('js', new Date())

      gtag('config', 'G-8E24NNDK21')
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N"
      crossorigin="anonymous"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp"
      crossorigin="anonymous" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" />
    <script>
      async function getRequest() {
        const getResponse = await fetch('https://lecture.syu.kr/api/professor/v1/all', {
          method: 'get',
        })
        const getJson = await getResponse.json()
        return getJson
      }

      async function getList(obj) {
        let professorName = obj.innerHTML.replace(
          /\(컴퓨터공학부\)|\(컴퓨터·메카트로닉스공학부\)|\(컴퓨터학부\)/g,
          '',
        )
        const getResponse = await fetch(
          'https://lecture.syu.kr/api/professor/v1/' + professorName,
          {
            method: 'get',
          },
        )

        if (getResponse.status == 401) {
          document.getElementById(obj.innerHTML + '-info').innerHTML = '정보가 없습니다.'
          return
        }

        const getJson = await getResponse.json()

        html = ''

        for (lecture in getJson) {
          html += '<h6 style="margin: 5px; font-weight: bold;">' + lecture + '</h6>'
          html += '<hr style="border: 2px solid;"/>'
          for (recommend of getJson[lecture]) {
            html += '<p style="font-size: 14px;">' + recommend + '</p>'
            if (getJson[lecture].at(-1) != recommend) {
              html += '<hr style="border-top: 2px dotted;"/>'
            } else {
              html += '<div style="margin: 40px"></div>'
            }
          }
        }

        document.getElementById(obj.innerHTML + '-info').innerHTML = html
      }

      getRequest().then(function (data) {
        let html = ''
        Object.keys(data)
          .reverse()
          .forEach(function (ys) {
            html += '<h4>' + ys + ' 교수진</h4>'
            html += '<hr />'
            html += '<ul>'
            for (professor of data[ys]) {
              if (ys == '2023 1학기 정규') {
                html +=
                  '<li><a href="#' +
                  professor +
                  '" data-bs-toggle="modal" data-bs-target="#' +
                  professor +
                  '" onclick="getList(this);">' +
                  professor +
                  '</a></li>'
                html += `
                <div class="modal fade" id="${professor}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">${professor}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <span id="${professor + '-info'}">
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                      </div>
                    </div>
                  </div>
                </div>
                `
              } else {
                html += '<li>' + professor + '</li>'
              }
            }
            html += '</ul>'
          })
        document.getElementById('professor').innerHTML = html
      })
    </script>
  </head>
  <body>
    <h2 style="font-weight: bold; text-align: center; margin: 10px">
      삼육대학교 컴퓨터공학부 강의평가 조회
    </h2>
    <div style="border: 1px solid; padding: 10px; margin: 10px">
      <p>Sahmyook Univ. CSE. EveryTime. Lecture evaluation.</p>
      <a href="https://github.com/syu-kr/cse-lecture">CSE-Lecture Crawling Source</a>
    </div>
    <span id="professor" style="margin: 10px"></span>
  </body>
</html>
